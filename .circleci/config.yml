version: 2.1

orbs:
  shellcheck: circleci/shellcheck@2.2.4

jobs:
  job-nightly:
    docker:
      - image: alpine:3.14

    steps:
      - add_ssh_keys:
          fingerprints:
            - "8f:33:bb:3a:3b:6b:83:c0:1d:e8:25:31:dc:3f:76:1c"
      - run:
          name: Install git
          command: |
            apk add \
                --update-cache \
                --no-progress \
                openssh \
                git \
                bash \
      - checkout
#      - shellcheck/install
#      - shellcheck/check:
#          pattern: update-reproducibility-summary.sh
      - run:
          command: |
            ./update-reproducibility-summary.sh
      - run:
          name: Configure git
          command: |
            git config user.email "nightly@reproducible-build.ci"
            git config user.name "Nightly Build Bot"
      - run:
          name: Commit Changes to README.md
          command: |
            git add README.md
            git status
            git commit -m "nigthly update of README.md [skip ci]"
      - run:
          name: Push Changes to README.md
          command: |
            git push

workflows:
  build:
    jobs:
      - job-nightly


